<?xml version="1.0" encoding="utf-8"?>
<!--
 
    Copyright (C) Cetmix OÃœ

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU LESSER GENERAL PUBLIC LICENSE as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU LESSER GENERAL PUBLIC LICENSE for more details.

    You should have received a copy of the GNU LESSER GENERAL PUBLIC LICENSE
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<odoo>
    <!--################
        # Mail.Message #
        ################-->
    <!--## Tree ##-->
    <record id="prt_mail_message_tree" model="ir.ui.view">
        <field name="name">prt.mail.message.tree</field>
        <field name="model">mail.message</field>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <tree create="false" decoration-bf="needaction==True" decoration-danger="has_error==True" default_order="id desc" delete="false" edit="false" js_class="mail_messages_update_list">
                <field name="subject_display" string="Message"/>
                <field invisible="1" name="needaction"/>
                <field invisible="1" name="has_error"/>
            </tree></field>
    </record>
    <!--## Form ##-->
    <record id="prt_mail_message_form" model="ir.ui.view">
        <field name="name">prt.mail.message.form</field>
        <field name="model">mail.message</field>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <form create="false" delete="false" edit="false" string="Message">
                <field invisible="1" name="active"/>
                <field invisible="1" name="delete_uid"/>
                <field invisible="1" name="delete_date"/>
                <header>
                    <button context="{'wizard_mode': False}" help="Post new message to record. Record followers will be notified!" icon="fa-reply" name="reply" string="Reply" type="object"/>
                    <button context="{'wizard_mode': 'quote'}" help="Post new message to record. Original message text will be qouted. Record followers will be notified!" icon="fa-quote-left" name="reply" string="Quote" type="object"/>
                    <button context="{'wizard_mode': 'forward'}" help="Copy message to other record. Original message text will be qouted and kept. Followers of the other record will be notified!" icon="fa-copy" name="reply" string="Forward" type="object"/>
                    <button help="Move message from current to other record" icon="fa-arrow-right" invisible="0" name="move" string="Move" type="object"/>
                    <button confirm="Are you sure?" help="Delete message" icon="fa-trash" invisible="delete_uid != False and delete_date != False" name="unlink_pro" string="Delete" type="object"/>
                    <button confirm="Are you sure?" help="Delete completely message" icon="fa-trash" invisible="delete_uid == False and delete_date == False" name="unlink_pro" string="Delete completely" type="object"/>
                    <button confirm="Are you sure?" help="Undelete message" icon="fa-trash" invisible="delete_uid == False and delete_date == False" name="undelete" string="Undelete" type="object"/>
                    <button confirm="Are you sure?" help="Archive message" icon="fa-archive" invisible="active == False" name="archive" string="Archive" type="object"/>
                    <button confirm="Are you sure?" help="Unarchive message" icon="fa-archive" invisible="active == True" name="archive" string="Unarchive" type="object"/>
                    <button help="Edit message" icon="fa-edit" invisible="0" name="message_edit" string="Edit" type="object"/>
                    <button icon="fa-envelope" invisible="thread_messages_count &lt; 2" name="thread_messages" string="Open Thread" type="object"/>
                    <button class="oe_highlight" icon="fa-file" invisible="needaction == False" name="mark_read_multi" string="Mark read" type="object"/>
                    <button icon="fa-check" invisible="starred == True" name="toggle_message_starred" string="Star" type="object"/>
                    <button class="oe_highlight" icon="fa-star" invisible="starred == False" name="toggle_message_starred" string="Unstar" type="object"/>
                    <field invisible="1" name="thread_messages_count" string="In thread"/>
                </header>
                <div class="oe_form_box_info oe_text_center" colspan="2" invisible="has_error != True" name="pro" style="color:red;">
                    <p>
                        Error while sending message. Please check error log under "Email
                        Messages" tab
                    </p>
                </div>
                <sheet>
                    <field class="oe_avatar" name="author_avatar" widget="image"/>
                    <div class="oe_title">
                        <h1>
                            <field invisible="subject == False" name="subject"/>
                        </h1>
                        <div class="o_row">
                            <strong>
                                <field name="model_name"/>
                                <span>
                                    :
                                </span>
                            </strong>
                            <field invisible="record_ref == False" name="record_ref"/>
                            <field invisible="1" name="has_error"/>
                        </div>
                    </div>
                    <group name="base">
                        <field invisible="1" name="needaction"/>
                        <field invisible="1" name="starred"/>
                        <field name="date"/>
                        <field invisible="author_allowed_id == False" name="author_allowed_id"/>
                        <label for="email_from" invisible="author_allowed_id != False"/>
                        <div class="o_row">
                            <span style="display:contents!important">
                                <field name="email_from"/>
                            </span>
                            <button invisible="author_allowed_id != False" name="assign_author" string="Assign Author" type="object"/>
                        </div>
                        <field invisible="1" name="partner_count"/>
                        <field invisible="partner_count == 0" name="partner_ids" widget="many2many_tags"/>
                        <field invisible="ref_partner_count == 0" name="ref_partner_ids" widget="many2many_tags"/>
                        <field invisible="1" name="ref_partner_count"/>
                    </group>
                    <notebook>
                        <page name="body" string="Body">
                            <div style="margin-left:10px">
                                <br/>
                                <field name="body" nolabel="1"/>
                                <p style="font-size:x-small;color:#1D8348;font-style:italic;">
                                    <field invisible="cx_edit_message == False" name="cx_edit_message"/>
                                </p>
                            </div>
                        </page>
                        <page invisible="attachment_count == 0" name="attachments" string="Attachments">
                            <sheet>
                                <field invisible="1" name="attachment_count"/>
                                <field name="attachment_ids" widget="many2many_binary"/>
                            </sheet>
                        </page>
                        <page groups="prt_mail_messages.group_technical" name="technical" string="Technical">
                            <group name="technical">
                                <field name="parent_id"/>
                                <field name="message_type"/>
                                <field name="subtype_id"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form></field>
    </record>
    <!--## Action ##-->
    <record id="action_prt_mail_messages" model="ir.actions.act_window">
        <field name="name">Messages</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('message_type', 'in', ['email', 'comment'])]</field>
        <field name="context">{'check_messages_access': True, 'search_default_filter_inbox_shared': 1}</field>
        <field name="view_mode">tree,form</field>
        <field eval="[(5, 0, 0),           (0, 0, {'view_mode': 'tree', 'view_id': ref('prt_mail_message_tree')}),           (0, 0, {'view_mode': 'form', 'view_id': ref('prt_mail_message_form')})]" name="view_ids"/>
    </record>
    <!-- Contacts action -->
    <record id="action_prt_mail_messages_contacts" model="ir.actions.act_window">
        <field name="name">Contacts</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="search_view_id" ref="base.view_res_partner_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to add a contact in your address book.
            </p>
            <p>
                Odoo helps you easily track all activities related to
            a customer: discussions, history of business opportunities,
            documents, etc.
            </p></field>
    </record>
    <!--## Menu ##-->
    <menuitem groups="base.group_user,base.group_partner_manager" id="prt_messages_root" name="Messages" sequence="6" web_icon="prt_mail_messages,static/description/icon_menu.png"/>
    <menuitem action="action_prt_mail_messages" groups="base.group_user,base.group_partner_manager" id="prt_messages_messages" name="Messages" parent="prt_messages_root" sequence="0"/>
    <!--# Message archived ad trash -->
    <record id="action_prt_mail_messages_archived" model="ir.actions.act_window">
        <field name="name">Archived</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('active', '=', False), ('delete_uid', '=', False)]</field>
        <field name="view_mode">tree,form</field>
        <field eval="[(5, 0, 0),           (0, 0, {'view_mode': 'tree', 'view_id': ref('prt_mail_message_tree')}),           (0, 0, {'view_mode': 'form', 'view_id': ref('prt_mail_message_form')})]" name="view_ids"/>
    </record>
    <menuitem action="action_prt_mail_messages_archived" id="prt_messages_archived" name="Archived" parent="prt_messages_root" sequence="15"/>
    <record id="action_prt_mail_messages_trash" model="ir.actions.act_window">
        <field name="name">Trash</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.message</field>
        <field name="domain">[('active', '=', False), ('delete_uid', '!=', False)]</field>
        <field name="view_mode">tree,form</field>
        <field eval="[(5, 0, 0),           (0, 0, {'view_mode': 'tree', 'view_id': ref('prt_mail_message_tree')}),           (0, 0, {'view_mode': 'form', 'view_id': ref('prt_mail_message_form')})]" name="view_ids"/>
    </record>
    <menuitem action="action_prt_mail_messages_trash" id="prt_messages_trash" name="Trash" parent="prt_messages_root" sequence="16"/>
    <menuitem action="action_prt_mail_messages_contacts" groups="base.group_user,base.group_partner_manager" id="prt_messages_contacts" name="Contacts" parent="prt_messages_root" sequence="10"/>
    <menuitem groups="group_technical,base.group_system" id="prt_messages_settings" name="Settings" parent="prt_messages_root" sequence="100"/>
    <!--## Search ##-->
    <record id="prt_mail_message_search" model="ir.ui.view">
        <field name="name">prt.mail.message.search</field>
        <field name="model">mail.message</field>
        <field name="inherit_id" ref="mail.view_message_search"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <field name="author_id" position="replace">
                <field filter_domain="['|', ('author_id', 'ilike', self), ('email_from', 'ilike', self)]" name="author_id" string="Author"/></field>
            <filter name="filter_has_mentions" position="before">
                <filter domain="[('shared_inbox', '=', True)]" name="filter_inbox_shared" string="Shared Inbox"/>
                <separator/>
                <filter domain="[('partner_ids.user_ids', 'in', [uid])]" name="filter_inbox_private" string="Private Inbox"/>
                <separator/>
                <filter domain="[('author_id.user_ids', 'in', [uid])]" name="filter_sent_by_me" string="Sent by Me"/>
                <separator/>
                <filter domain="[('subtype_id', '=', %(mail.mt_comment)d)]" name="filter_subtype_comment" string="Messages Only"/>
                <filter domain="[('subtype_id', '=', %(mail.mt_note)d)]" name="filter_subtype_internal_note" string="Internal Notes"/>
                <separator/>
                <filter domain="[('author_allowed_id', '=', False)]" name="filter_author_unassigned" string="Author not detected"/>
                <separator/>
                <group string="Group By">
                    <filter context="{'group_by':'author_id'}" domain="[]" name="groupby_author" string="Author"/>
                    <separator/>
                    <filter context="{'group_by':'date'}" domain="[]" name="groupby_date" string="Date"/>
                </group>
            </filter>
            <filter name="message_needaction" position="after">
                <filter domain="[('starred', '=', True)]" name="filter_starred" string="Starred"/>
            </filter>
            <filter name="message_needaction" position="attributes">
                <attribute name="string">
                    Unread</attribute>
            </filter>
            <filter name="filter_has_mentions" position="replace"/></field>
    </record>
</odoo>
